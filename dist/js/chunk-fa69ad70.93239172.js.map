{"version":3,"sources":["webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?3b37","webpack:///./src/views/category/Category.vue?82ce"],"names":["id","class","default","active","tabClick","title","activeKey","activeName","accordion","categories","item","key","name","children","sub","getGoods","showGoods","itemClick","num","comments_count","tag","price","desc","updated_at","thumb","cover_url","lazy-load","bTop","isShowBackTop","getCategoryData","request","url","getCategoryGoods","order","cid","page","components","NavBar","BackTop","setup","router","currentOrder","currentCid","goods","sales","list","bscroll","value","init","then","res","data","document","querySelector","probeType","click","pullUpLoad","on","position","y","console","log","push","finishPullUp","refresh","clientHeight","index","scrollTo","path","query","render","__scopeId"],"mappings":"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","file":"js/chunk-fa69ad70.93239172.js","sourcesContent":["<template>\n  <NavBar>\n    <template v-slot:default>分类页面</template>\n  </NavBar>\n  <div id=\"mainbox\">\n    <div class=\"order-tab\">\n      <van-tabs v-model=\"active\" @click=\"tabClick\">\n        <van-tab title=\"销量排序\"></van-tab>\n        <van-tab title=\"价格排序\"></van-tab>\n        <van-tab title=\"评论排序\"></van-tab>\n      </van-tabs>\n    </div>\n\n    <van-sidebar class=\"leftmenu\" v-model=\"activeKey\">\n      <van-collapse v-model=\"activeName\" accordion>\n        <van-collapse-item\n          v-for=\"item in categories\"\n          :key=\"item.id\"\n          :title=\"item.name\"\n          :name=\"item.name\"\n        >\n          <van-sidebar-item\n            v-for=\"sub in item.children\"\n            :key=\"sub.id\"\n            :title=\"sub.name\"\n            @click=\"getGoods(sub.id)\"\n          />\n        </van-collapse-item>\n      </van-collapse>\n    </van-sidebar>\n\n    <div class=\"goodslist\">\n      <div class=\"content\">\n        <van-card\n          @click=\"itemClick(item.id)\"\n          v-for=\"item in showGoods\"\n          :key=\"item.id\"\n          :num=\"item.comments_count\"\n          :tag=\"item.comments_count >= 0 ? '流行' : '标签'\"\n          :price=\"item.price\"\n          :desc=\"item.updated_at\"\n          :title=\"item.title\"\n          :thumb=\"item.cover_url\"\n          :lazy-load=\"true\"\n        />\n      </div>\n    </div>\n  </div>\n  <BackTop @bTop=\"bTop\" v-show=\"isShowBackTop\"></BackTop>\n</template>\n\n<script>\nimport NavBar from 'components/common/navbar/NavBar'\nimport BackTop from 'components/common/backtop/BackTop'\nimport { computed, nextTick, onMounted, reactive, ref, watchEffect } from 'vue'\nimport { getCategoryData, getCategoryGoods } from 'network/category'\nimport { useRouter } from 'vue-router'\nimport BScroll from 'better-scroll'\n\nexport default {\n  components: {\n    NavBar,\n    BackTop\n  },\n  setup() {\n    const router = useRouter()\n    let active = ref(1)\n    let activeKey = ref(0)\n    let categories = ref([])\n    let activeName = ref(0)\n    let isShowBackTop = ref(false)\n    // 当前的排序条件\n    let currentOrder = ref('sales')\n    // 当前的分类ID\n    let currentCid = ref(0)\n\n    // 数据模型\n    const goods = reactive({\n      sales: {\n        page: 1,\n        list: []\n      },\n      price: {\n        page: 1,\n        list: []\n      },\n      comments_count: {\n        page: 1,\n        list: []\n      }\n    })\n\n    let bscroll = reactive({})\n    // let banners = ref([])\n    const showGoods = computed(() => {\n      return goods[currentOrder.value].list\n    })\n\n    const init = () => {\n      getCategoryGoods('sales', currentCid.value).then((res) => {\n        goods.sales.list = res.goods.data\n      })\n      getCategoryGoods('price', currentCid.value).then((res) => {\n        goods.price.list = res.goods.data\n      })\n      getCategoryGoods('comments_count', currentCid.value).then((res) => {\n        goods.comments_count.list = res.goods.data\n      })\n    }\n\n    onMounted(() => {\n      getCategoryData().then((res) => {\n        categories.value = res.categories\n      })\n\n      init()\n\n      // 创建BetterScroll对象\n      bscroll = new BScroll(document.querySelector('.goodslist'), {\n        probeType: 3,\n        click: true,\n        pullUpLoad: true\n      })\n      // 触发滚动事件\n      bscroll.on('scroll', (position) => {\n        isShowBackTop.value = -position.y > 300\n      })\n      bscroll.on('pullingUp', () => {\n        console.log('上拉加载更多')\n\n        const page = goods[currentOrder.value].page + 1\n\n        getCategoryGoods(currentOrder.value, currentCid.value, page).then(\n          (res) => {\n            console.log(res.goods.data)\n            goods[currentOrder.value].list.push(...res.goods.data)\n            goods[currentOrder.value].page += 1\n          }\n        )\n        // 完成上拉，等数据请求完成，要将新数据展示出来\n        bscroll.finishPullUp()\n        console.log('当前类型:' + currentCid.value + ',当前页：' + page)\n\n        // 重新计算高度\n        bscroll.refresh()\n        console.log(\n          'contentTheHeight：' + document.querySelector('.content').clientHeight\n        )\n      })\n    })\n    // 排序选项卡\n    const tabClick = (index) => {\n      let order = ['sales', 'price', 'comments_count']\n      currentOrder.value = order[index]\n\n      getCategoryGoods(currentOrder.value, currentCid.value).then((res) => {\n        goods.sales.list = res.goods.data\n\n        nextTick(() => {\n          // 重新计算高度\n          bscroll && bscroll.refresh()\n        })\n      })\n    }\n    // 通过分类得到商品\n    const getGoods = (cid) => {\n      currentCid.value = cid\n      console.log('当前的id：' + cid)\n      getCategoryGoods('sales', currentCid.value).then((res) => {\n        goods.sales.list = res.goods.data\n      })\n    }\n    // 监听任何一个变量有变化就会触发\n    watchEffect(() => {\n      nextTick(() => {\n        // 重新计算高度\n        bscroll && bscroll.refresh()\n      })\n    })\n    const bTop = () => {\n      bscroll.scrollTo(0, 0, 500)\n    }\n    return {\n      activeKey,\n      categories,\n      activeName,\n      active,\n      tabClick,\n      currentOrder,\n      getGoods,\n      currentCid,\n      showGoods,\n      isShowBackTop,\n      bTop,\n      itemClick: (id) => {\n        router.push({ path: '/detail', query: { id } })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n#mainbox {\n  margin-top: 45px;\n  .order-tab {\n    height: 50px;\n    z-index: 9;\n    position: fixed;\n    top: 45px;\n    right: 0px;\n    left: 130px;\n  }\n  .leftmenu {\n    position: fixed;\n    top: 95px;\n    left: 0px;\n    width: 130px;\n  }\n  .goodslist {\n    position: absolute;\n    top: 100px;\n    left: 130px;\n    right: 0;\n    padding: 10px;\n    text-align: left !important;\n    overflow: hidden;\n    height: 100vh;\n    .content {\n    }\n  }\n}\n.van-card__thumb {\n  width: 68px !important;\n}\n@media screen and (min-width: 768px) {\n  #mainbox .goodslist {\n    height: 550px;\n  }\n  .leftmenu {\n    height: 550px;\n    overflow: hidden;\n  }\n}\n</style>\n","import { request } from './request'\n\nexport function getCategoryData() {\n  return request({\n    url: '/api/goods'\n  })\n}\n\nexport function getCategoryGoods(order = 'sales', cid = 0, page = 1) {\n  return request({\n    url: `/api/goods?category_id=${cid}&page=${page}&${order}=1`\n\n  })\n}\n","import { render } from \"./Category.vue?vue&type=template&id=27937ebb&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=27937ebb&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-27937ebb\"\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=27937ebb&lang=scss&scoped=true\""],"sourceRoot":""}