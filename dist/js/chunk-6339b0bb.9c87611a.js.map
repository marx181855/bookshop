{"version":3,"sources":["webpack:///./src/views/order/OrderDetail.vue","webpack:///./src/views/order/OrderDetail.vue?c009","webpack:///./src/views/order/OrderDetail.vue?01f6"],"names":["class","style","default","statusString","detail","order_no","created_at","status","showPayFn","color","block","handleConfirmOrder","total","orderDetails","data","item","key","id","num","price","desc","title","goods","thumb","cover_url","show","showPay","position","border","column-num","width","height","src","aliyun","wechat","components","NavBar","setup","route","router","state","orderNo","init","query","then","res","console","log","loading","message","forbidClick","clear","sum","forEach","type","qr_code_url","timer","setInterval","clearInterval","push","path","confirm","status_code","catch","close","render","__scopeId"],"mappings":"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","file":"js/chunk-6339b0bb.9c87611a.js","sourcesContent":["<template>\r\n  <div class=\"order-detail-box\">\r\n    <nav-bar class=\"nav-bar\">\r\n      <template v-slot:default>订单详情</template>\r\n    </nav-bar>\r\n    <div class=\"order-status\">\r\n      <div class=\"status-item\">\r\n        <label>订单状态：</label>\r\n        <span>{{ statusString }}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>订单编号：</label>\r\n        <span>{{ detail.order_no }}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>下单时间：</label>\r\n        <span>{{ detail.created_at }}</span>\r\n      </div>\r\n      <van-button\r\n        v-if=\"detail.status == 1\"\r\n        @click=\"showPayFn\"\r\n        style=\"margin-bottom: 10px\"\r\n        color=\"#1baeae\"\r\n        block\r\n      >去支付</van-button>\r\n      <van-button v-if=\"detail.status == 3\" @click=\"handleConfirmOrder\">确认订单</van-button>\r\n    </div>\r\n    <div class=\"order-price\">\r\n      <div class=\"price-item\">\r\n        <label>商品金额：</label>\r\n        <span>￥{{ total + \".00\" }}</span>\r\n      </div>\r\n      <div class=\"price-item\">\r\n        <label>配送方式：</label>\r\n        <span>普通快递</span>\r\n      </div>\r\n    </div>\r\n\r\n    <van-card\r\n      v-for=\"item in detail.orderDetails.data\"\r\n      :key=\"item.id\"\r\n      :num=\"item.num\"\r\n      :price=\"item.price\"\r\n      desc=\"全场包邮\"\r\n      :title=\"item.goods.title\"\r\n      :thumb=\"item.goods.cover_url\"\r\n    />\r\n\r\n    <div style=\"width: 100%; height: 50px\"></div>\r\n    <van-popup v-model:show=\"showPay\" position=\"bottom\" :style=\"{ height: '40%' }\">\r\n      <div :style=\"{ width: '90%', margin: '0 auto', padding: '50px 0' }\">\r\n        <van-grid :border=\"false\" :column-num=\"2\">\r\n          <van-grid-item>\r\n            支付宝二维码\r\n            <br />\r\n            <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n          </van-grid-item>\r\n          <van-grid-item>\r\n            微信支付二维码\r\n            <br />\r\n            <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n          </van-grid-item>\r\n        </van-grid>\r\n      </div>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NavBar from 'components/common/navbar/NavBar'\r\nimport { useRouter, useRoute } from 'vue-router'\r\n// import { useStore } from 'vuex'\r\nimport { computed, onMounted, reactive, toRefs } from 'vue'\r\nimport {\r\n  getOrderDetail,\r\n  confirmOrder,\r\n  payOrder,\r\n  getOrderStatus\r\n} from 'network/order'\r\nimport { Toast, Dialog } from 'vant'\r\nexport default {\r\n  components: {\r\n    NavBar\r\n  },\r\n  setup() {\r\n    const route = useRoute()\r\n    const router = useRouter()\r\n    // const store = useStore()\r\n    const state = reactive({\r\n      orderNo: '', // 订单ID\r\n      detail: {\r\n        orderDetails: {\r\n          data: []\r\n        }\r\n      },\r\n      showPay: false,\r\n      aliyun: '',\r\n      wechat: ''\r\n    })\r\n    const init = () => {\r\n      const { id } = route.query\r\n      state.orderNo = id\r\n      getOrderDetail(id).then((res) => {\r\n        console.log(res)\r\n        state.detail = res\r\n      })\r\n    }\r\n\r\n    onMounted(() => {\r\n      Toast.loading({ message: '加载中...', forbidClick: true })\r\n      init()\r\n      Toast.clear()\r\n    })\r\n    const statusString = computed(() => {\r\n      // 1下单 2支付 3发货 4收货 5过期\r\n      let status = ['', '已下单', '已支付', '等待发货', '确认收货', '已过期']\r\n      return status[state.detail.status]\r\n    })\r\n    const total = computed(() => {\r\n      let sum = 0\r\n      state.detail.orderDetails.data.forEach((item) => {\r\n        sum += item.num * item.price\r\n      })\r\n      return sum\r\n    })\r\n    const showPayFn = () => {\r\n      state.showPay = true\r\n      payOrder(state.orderNo, { type: 'aliyun' }).then((res) => {\r\n        console.log(res)\r\n        state.aliyun = res.qr_code_url\r\n        state.wechat = res.qr_code_url\r\n      })\r\n      const timer = setInterval(() => {\r\n        getOrderStatus(state.orderNo).then((res) => {\r\n          if (res === '2') {\r\n            clearInterval(timer)\r\n            state.showPay = false\r\n            router.push({ path: '/orderdetail', query: { id: state.orderNo } })\r\n          }\r\n        })\r\n      }, 2000)\r\n    }\r\n    const handleConfirmOrder = () => {\r\n      Dialog.confirm({\r\n        title: '是否确认订单'\r\n      })\r\n        .then(() => {\r\n          confirmOrder(state.orderNo).then(res => {\r\n            console.log(res)\r\n            if (res.status_code === '204') {\r\n              Toast('确认成功')\r\n              init()\r\n            }\r\n          })\r\n        })\r\n        .catch(() => { })\r\n    }\r\n    const close = () => {\r\n      Dialog.close()\r\n    }\r\n    return {\r\n      ...toRefs(state),\r\n      statusString,\r\n      total,\r\n      showPayFn,\r\n      handleConfirmOrder,\r\n      close\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.order-status {\r\n  margin-top: 50px;\r\n  .status-item {\r\n    text-align: left;\r\n    padding: 5px;\r\n    label {\r\n      color: grey;\r\n    }\r\n  }\r\n  .van-button {\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n.order-price {\r\n  text-align: left;\r\n  margin-left: 10px;\r\n  margin-top: 30px;\r\n  margin-bottom: 30px;\r\n  label {\r\n    color: grey;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./OrderDetail.vue?vue&type=template&id=6691b161&scoped=true\"\nimport script from \"./OrderDetail.vue?vue&type=script&lang=js\"\nexport * from \"./OrderDetail.vue?vue&type=script&lang=js\"\n\nimport \"./OrderDetail.vue?vue&type=style&index=0&id=6691b161&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6691b161\"\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OrderDetail.vue?vue&type=style&index=0&id=6691b161&lang=scss&scoped=true\""],"sourceRoot":""}