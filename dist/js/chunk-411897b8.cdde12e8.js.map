{"version":3,"sources":["webpack:///./src/views/order/CreateOrder.vue?9313","webpack:///./src/views/order/CreateOrder.vue","webpack:///./src/views/order/CreateOrder.vue?5840","webpack:///./node_modules/core-js/modules/es.function.name.js"],"names":["class","alt","default","goTo","address","name","phone","province","city","county","cartList","item","index","key","goods","cover_url","title","num","price","total","button-text","handleCreateOrder","show","showPay","closeable","close-on-click-overlay","position","style","close","border","column-num","width","height","src","aliyun","wechat","components","NavBar","setup","router","store","state","orderNo","init","loading","message","forbidClick","then","res","filter","n","is_default","length","carts","console","log","push","path","params","address_id","id","success","dispatch","type","qr_code_url","timer","setInterval","clearInterval","query","sum","forEach","parseInt","parseFloat","render","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error"],"mappings":"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","file":"js/chunk-411897b8.cdde12e8.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateOrder.vue?vue&type=style&index=0&id=a5755c68&lang=scss\"","<template>\n  <div class=\"create-order\">\n    <NavBar>\n      <template v-slot:default>订单预览</template>\n    </NavBar>\n    <div class=\"address-wrap\">\n      <div class=\"name\" @click=\"goTo\">\n        <span>{{ address.name }}</span>\n        <span>{{ address.phone }}</span>\n      </div>\n      <div class=\"address\">{{ address.province + address.city + address.county + address.address }}</div>\n      <van-icon class=\"arrow\" name=\"arrow\" />\n    </div>\n    <div class=\"good\">\n      <div class=\"good-item\" v-for=\"(item, index) in cartList\" :key=\"index\">\n        <div class=\"good-img\">\n          <img v-lazy=\"item.goods.cover_url\" alt />\n        </div>\n        <div class=\"good-desc\">\n          <div class=\"good-title\">\n            <span>{{ item.goods.title }}</span>\n            <span>x{{ item.num }}</span>\n          </div>\n          <div class=\"good-btn\">\n            <div class=\"price\">\n              <small>￥</small>\n              {{ item.goods.price + \".00\" }}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <van-submit-bar\n      class=\"submit-all\"\n      :price=\"total * 100\"\n      button-text=\"生成订单\"\n      @submit=\"handleCreateOrder\"\n    >商品余额</van-submit-bar>\n    <van-popup\n      v-model:show=\"showPay\"\n      closeable\n      :close-on-click-overlay=\"false\"\n      position=\"bottom\"\n      :style=\"{ height: '40%' }\"\n      @close=\"close\"\n    >\n      <van-grid :border=\"false\" :column-num=\"2\">\n        <van-grid-item>\n          支付宝二维码\n          <br />\n          <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\n        </van-grid-item>\n        <van-grid-item>\n          微信支付二维码\n          <br />\n          <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\n        </van-grid-item>\n      </van-grid>\n    </van-popup>\n  </div>\n</template>\n\n<script>\nimport NavBar from 'components/common/navbar/NavBar'\nimport { computed, onMounted, reactive, toRefs } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useStore } from 'vuex'\nimport {\n  createOrder,\n  getOrderPreview,\n  payOrder,\n  getOrderStatus\n} from 'network/order.js'\nimport { Toast } from 'vant'\nexport default {\n  components: {\n    NavBar\n  },\n  setup() {\n    const router = useRouter()\n    const store = useStore()\n    const state = reactive({\n      cartList: [],\n      address: {},\n      showPay: false,\n      orderNo: '',\n      aliyun: '',\n      wechat: ''\n    })\n    const init = () => {\n      Toast.loading({\n        message: '加载中...',\n        forbidClick: true\n      })\n      getOrderPreview().then((res) => {\n        let address = res.address.filter((n) => n.is_default === '1')\n        if (address.length === 0) {\n          state.address = {\n            address: '还没有设置默认地址，选择或者填写地址信息'\n          }\n        } else {\n          state.address = address[0]\n        }\n        state.cartList = res.carts\n        console.log(res)\n      })\n    }\n    onMounted(() => {\n      init()\n    })\n    const goTo = () => {\n      router.push({ path: '/address' })\n    }\n\n    const handleCreateOrder = () => {\n      const params = {\n        address_id: state.address.id\n      }\n\n      // 创建订单\n      createOrder(params).then((res) => {\n        Toast.success('创建订单成功')\n        store.dispatch('updateCart')\n\n        state.showPay = true\n        // 订单ID\n        state.orderNo = res.id\n        payOrder(state.orderNo, { type: 'aliyun' }).then((res) => {\n          console.log(res)\n          state.aliyun = res.qr_code_url\n          state.wechat = res.qr_code_url\n        })\n        // payOrder(state.orderNo, { type: 'wechat' }).then((res) => {\n        //   console.log(res)\n        //   state.wechat = res.qr_code_url\n        // })\n\n        // 轮询查看\n        const timer = setInterval(() => {\n          getOrderStatus(state.orderNo).then((res) => {\n            if (res === '2') {\n              clearInterval(timer)\n              router.push({ path: '/orderdetail', query: { id: state.orderNo } })\n            }\n          })\n        }, 2000)\n      })\n    }\n    const close = () => {\n      router.push({ path: '/orderdetail', query: { id: state.orderNo } })\n    }\n    const total = computed(() => {\n      let sum = 0\n      state.cartList.forEach((item) => {\n        sum += parseInt(item.num) * parseFloat(item.goods.price)\n      })\n      return sum\n    })\n    return {\n      ...toRefs(state),\n      goTo,\n      handleCreateOrder,\n      close,\n      total\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.create-order {\n  background: #f9f9f9;\n  .address-wrap {\n    text-align: left;\n    margin-bottom: 20px;\n    background: #fff;\n    position: relative;\n    margin-top: 44px;\n    font-size: 14px;\n    padding: 15px;\n    color: #222333;\n    .name,\n    .address {\n      margin: 10px 0;\n    }\n    .arrow {\n      position: absolute;\n      right: 10px;\n      top: 50%;\n      transform: translateY(-50%);\n      font-size: 20px;\n    }\n    &::before {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      left: 0;\n      height: 2px;\n      background: -webkit-linear-gradient();\n      background-size: 80px;\n      content: \"\";\n    }\n  }\n  .good {\n    margin-bottom: 120px;\n  }\n  .good-item {\n    padding: 10px;\n    background: #fff;\n    display: flex;\n    .good-img {\n      img {\n        width: 100px;\n        height: auto;\n      }\n    }\n    .good-desc {\n      display: flex;\n      flex-direction: column;\n      justify-content: space-between;\n      flex: 1;\n      padding: 20px;\n      .good-title {\n        display: flex;\n        justify-content: space-between;\n      }\n      .good-btn {\n        display: flex;\n        justify-content: space-between;\n        .price {\n          font-size: 16px;\n          color: red;\n          line-height: 28px;\n        }\n        .van-icon-delete {\n          font-size: 20px;\n          margin-top: 4px;\n        }\n      }\n    }\n  }\n  .pay-wrap {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    background: #fff;\n    padding: 10px 0;\n    padding-bottom: 50px;\n    border-top: 1px solid #e9e9e9;\n    > div {\n      display: flex;\n      justify-content: space-between;\n      padding: 0 5%;\n      margin: 10px 0;\n      font-size: 14px;\n      span:nth-child(2) {\n        color: red;\n        font-size: 18px;\n      }\n    }\n    .pay-btn {\n      position: fixed;\n      bottom: 7px;\n      right: 0;\n      left: 0;\n      width: 90%;\n      margin: 0 auto;\n    }\n  }\n}\n.submit-all {\n  margin-bottom: 50px;\n  z-index: 9 !important;\n}\n</style>\n","import { render } from \"./CreateOrder.vue?vue&type=template&id=a5755c68\"\nimport script from \"./CreateOrder.vue?vue&type=script&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=a5755c68&lang=scss\"\nscript.render = render\n\nexport default script","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n"],"sourceRoot":""}